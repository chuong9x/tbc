<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<!--
<script src="run_prettify.js" type="text/javascript"></script>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
-->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head></p>
<!---

- 13559666 [Strange graphics in Revit 2016 from a plug-in working fine in 2015]
  avoid exorbitant coordinates
  https://en.wiktionary.org/wiki/exorbitant#English

 #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon http://bit.ly/cloudmodelregen

Slabs created by an add-in are displayed perfectly in Revit 2015.
In Revit 2016, they are not.
What can be the problem?
These slabs are located at an exorbitant distance from the origin.
Relocating them closer to the origin resolves the problem...

--->

<h3>Avoid Exorbitant Coordinates</h3>
<p>With help from the Revit API development team, my
colleague <a href="http://thebuildingcoder.typepad.com/blog/2017/11/cloud-model-predicate-and-set-parameter-regenerates.html#2">Jim Jia</a> resolved
an issue involving large coordinates that is important to be aware of:</p>
<p><strong>Question:</strong> My program sets the parameters for a precast concrete slab family.</p>
<p>The family was created in Revit 2015 and all runs perfectly. </p>
<p>The family has been upgraded to Revit 2016 and the plug in still runs fine. </p>
<p>However, the slabs created in Revit 2016 look completely wrong.</p>
<p>Here is how they appear correctly in Revit 2015:</p>
<p><center>
<img src="img/exorbitant_2015_slabs_good.jpg" alt="Good slabs in Revit 2015" width="400"/>
</center></p>
<p>In Revit 2016, the slabs are displayed incorrectly and look like this:</p>
<p><center>
<img src="img/exorbitant_2016_slabs_bad.jpg" alt="Bad slabs in Revit 2016" width="400"/>
</center></p>
<p>If you hover the mouse over a slab in Revit 2016, the blue selection outline shows the correct slab geometry:</p>
<p><center>
<img src="img/exorbitant_2016_hover_slab_correct_outline.jpg" alt="Hovering over slabs in Revit 2016" width="400"/>
</center></p>
<p>I tried two different Revit 2016 installations with different graphics cards and get the same problem.</p>
<p>I also tried Revit 2018 and get the same problem.</p>
<p><strong>Answer:</strong> Is the slab possibly more than 20 miles from the origin?</p>
<p>Yes!</p>
<p>The instance locations I am getting from the input file are at:</p>
<pre>
  X = ~355 miles
  Y = ~130 miles
</pre>

<p>For testing, I added this line to the macro:</p>
<pre class="code">
&nbsp;&nbsp;<span style="color:#2b91af;">XYZ</span>&nbsp;origin&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">XYZ</span>(&nbsp;slabDetail.OX&nbsp;/&nbsp;mmToFeetRatio,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;slabDetail.OY&nbsp;/&nbsp;mmToFeetRatio,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;slabDetail.OZ&nbsp;/&nbsp;mmToFeetRatio&nbsp;);

&nbsp;&nbsp;<span style="color:#2b91af;">TaskDialog</span>.Show(&nbsp;<span style="color:#a31515;">&quot;Instance&nbsp;location&quot;</span>,&nbsp;origin.ToString()&nbsp;);
</pre>

<p>This is where I see feet values of <code>&gt;1.87</code> million for <code>X</code>.</p>
<p>These coordinates are truly <a href="https://en.wiktionary.org/wiki/exorbitant#English">exorbitant</a>!</p>
<p>Revit expects geometry to be placed relatively near its origin.</p>
<p>If this is violated, graphical issues such as these can result.</p>
<p>Why did it work in Revit 2015?</p>
<p>No idea, but placing elements at these distances has never, ever, been a good idea.</p>
<p><strong>Response:</strong> Wow, great!</p>
<p>I moved the family instances near to the origin and they are now created well.</p>