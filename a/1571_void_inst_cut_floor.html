<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<!--
<script src="run_prettify.js" type="text/javascript"></script>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
-->
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head></p>
<!---

Determine RVT version using #Python #RevitAPI @AutodeskRevit #bim #dynamobim @AutodeskForge #ForgeDevCon 

&ndash; 
...

-->

<h3>Determining Void Instances Cutting a Floor</h3>
<p>Yet another brilliant and super succinct solution provided by Fair59, answering
the <a href="http://forums.autodesk.com/t5/revit-api-forum/bd-p/160">Revit API discussion forum</a> thread on how
to <a href="https://forums.autodesk.com/t5/revit-api-forum/get-cutting-void-instances-in-the-floor/m-p/7170237">get cutting void instances in the floor</a>:</p>
<p><strong>Question:</strong> I have a floor on which a family instance is inserted on the face of the floor (the instance host is also the floor).</p>
<p>I checked in the family the "Cut with Void When Loaded" parameter, so that the void is created in the floor.</p>
<p>Now, I want to retrieve all the instances that create voids in the floor.</p>
<p>I did some research, and found the discussion
of <a href="http://thebuildingcoder.typepad.com/blog/2011/06/boolean-operations-and-instancevoidcututils.html">Boolean operations and <code>InstanceVoidCutUtils</code></a>.</p>
<p>But when I use the <code>InstanceVoidCutUtils</code> <code>GetCuttingVoidInstances</code> method, it returns an empty list.</p>
<p>I also looked
at the <a href="http://thebuildingcoder.typepad.com/blog/2015/07/intersect-solid-filter-avf-and-directshape-for-debugging.html#2"><code>ElementIntersectsSolidFilter</code> problem and solution</a> and
tried <code>ElementIntersectsElementFilter</code> and <code>ElementIntersectsSolidFilter</code>.</p>
<p>Those filters do not return the expected result for me to deduce the voids in the floor either; in fact, they say that no elements intersect.</p>
<p>First case &ndash; area = 607.558m2 and Volume = 243.023m3:</p>
<p><center>
<img src="img/void_inst_cut_floor_1.png" alt="Void instances cutting floor" width="1386">
</center></p>
<p>Second case &ndash; area = 607.558m2 and Volume = 243.023m3:</p>
<p><center>
<img src="img/void_inst_cut_floor_2.png" alt="Void instances cutting floor" width="1379">
</center></p>
<p><code>Family</code> parameter:</p>
<p><center>
<img src="img/void_inst_cut_floor_3.png" alt="Void instances cutting floor" width="1285">
</center></p>
<p><code>FamilyInstance</code> cutting:</p>
<p><center>
<img src="img/void_inst_cut_floor_4.png" alt="Void instances cutting floor" width="1293">
</center></p>
<p>Here is the code I use:</p>
<pre class="code">
Solid solid = floor.get_Geometry(new Options())
.OfType<Solid>()
.Where<Solid>(s => null != s && !s.Edges.IsEmpty)
.FirstOrDefault();

FilteredElementCollector intersectingInstances = new FilteredElementCollector(doc)
.OfClass(typeof(FamilyInstance))
.WherePasses(new ElementIntersectsSolidFilter(solid));

int n1 = intersectingInstances.Count<Element>();

intersectingInstances = new FilteredElementCollector(doc)
.OfClass(typeof(FamilyInstance))
.WherePasses(new ElementIntersectsElementFilter(floor));

int n = intersectingInstances.Count<Element>();
</pre>

<p>Here, both <code>n</code> and <code>n1</code> are equal to 0.</p>
<p><strong>Answer:</strong> Try using</p>
<pre class="code">
List<ElementId> intersectingInstanceIds = floor.FindInserts(false,false,false,true).ToList();
</pre>

<p><strong>Response:</strong> I have done some tests and here are my results:</p>
<p><center>
<img src="img/void_inst_cut_floor_6.png" alt="Void instances cutting floor" width="1405">
</center></p>
<p>Situation:</p>
<ul>
<li><code>Fl_1</code> is hosted by Level 3 and intersects the floor.</li>
<li><code>Fl_2</code> is hosted by the floor and intersects it.</li>
</ul>
<p>Results:</p>
<ol>
<li>Do not cut geometry:<ul>
<li><code>InstanceVoidCutUtils.GetCuttingVoidInstances(floor)</code> returns <code>void</code></li>
<li><code>floor.FindInserts(false,false,false,true)</code> returns <code>Fl_2</code></li>
</ul>
</li>
<li>Cut geometry:<ul>
<li><code>InstanceVoidCutUtils.GetCuttingVoidInstances(floor)</code> returns <code>Fl_1</code></li>
<li><code>floor.FindInserts(false,false,false,true)</code> returns both <code>Fl_1</code> and <code>Fl_2</code></li>
</ul>
</li>
</ol>
<p>In summary, <code>FindInserts</code> returns <code>FI_1</code> even if its host (Level 3) is not the floor.</p>
<p>It's good.</p>
<p>I think we can say that the problem is solved.</p>
<p>Thank you FAIR59 ;)</p>