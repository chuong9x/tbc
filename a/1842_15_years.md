<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head>

<!---

- Why does my add-in still work?
  Updating Plugins to Revit 2021
  https://forums.autodesk.com/t5/revit-api-forum/updating-plugins-to-revit-2021/m-p/9494369
  ramoon.bandeira 
  I'm trying to update a revit plugin for Revit 2021.
  The code of the plugin were designed for Revit 2019, but it also works in Revit 2020.
  I Followed the guide described here: https://bit.ly/2za2t6i
  and it worked for revit 2021 too. 
  I've seen that revit 2021 API had several changes, one of then regarding the UnitUtils.ConvertFromInternalUnits() method. Now it uses a ForgeUnitID instead of a DisplayUnitType enum member.
  My question is: Why the code that's been originally written in the 2019 version works seemlessly in Revit 2021 ?
  A: Good question.
  The answer is simple: the methods provided by the Revit API assemblies to serve the Revit API calls made by your add-in remain unchanged.
  New methods have been added, for instance, the new unit API ones that you mention. However, you are not using them, so that makes no difference for your add-in.
  Other methods may have been changed or even removed. However, luckily for you, you have not been using them, so that makes no difference for your add-in.

- get outer loop of points
  https://thebuildingcoder.typepad.com/blog/2017/10/disjunct-outer-loops-from-planar-face-with-separate-parts.html#comment-4898621997
  Francisco Contreras

twitter:

 in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon 

&ndash; 
...

linkedin:

#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="600"/>
<p style="font-size: 80%; font-style:italic"></p>
</center>

-->

### Convex Outer Loop, Non-Migration and 15-Year Stint

**Question:** 

<pre>
</pre>

<center>
<img src="img/fi_placement.png" alt="Family instance placement" title="Family instance placement" width="800"/> <!-- 1150 -->
</center>

**Answer:** 

**Response:** 

Many thanks to Richard for raising this tricky issue and to Scott for the illuminating solution!

####<a name="4"></a> Why Does My Add-In Still Run?

Michel Alofs provided a detailed explanation about how the Revit API updates handle the steps of signalling deprecated code and removing it a year later after it has become obsolete, raised in
the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread
on [updating plugins to Revit 2021](https://forums.autodesk.com/t5/revit-api-forum/updating-plugins-to-revit-2021/m-p/9494369):

**Question:** I'm trying to update a Revit plugin for Revit 2021.

The code of the plugin was designed for Revit 2019, but it also works in Revit 2020.

I Followed the guide 
on [how to maintain Revit plug-ins for multiple versions](https://archi-lab.net/how-to-maintain-revit-plug-ins-for-multiple-versions/) and
it works for Revit 2021 too. 

I've seen that the Revit 2021 API had several changes, one of then regarding the `UnitUtils.ConvertFromInternalUnits` method.
Now it uses a `ForgeUnitID` instead of a `DisplayUnitType` enum member.

My question is: Why does the code that's been originally written in the 2019 version works seemlessly in Revit 2021?

**Answer:** Good question.

The answer is simple: the methods provided by the Revit API assemblies to serve the Revit API calls made by your add-in remain unchanged.

New methods have been added, for instance, the new unit API ones that you mention. However, you are not using them, so that makes no difference for your add-in.

Other methods may have been changed or even removed. However, luckily for you, you have not been using them, so that makes no difference for your add-in.

In the code for R2019, you haven't used any of the removed 'obsolete' code in R2020/R2021.

For instance, the rules for filters changed in R2019 and the old style was removed in R2020.

So, if you had used a command with these methods, the add-in wouldn't run or crash (attempting to use the same assembly for R2020/R2021); also the .NET Framework version could be a issue.

See the post on [What's New in the Revit 2020 API](https://thebuildingcoder.typepad.com/blog/2019/04/whats-new-in-the-revit-2020-api.html).

**Response:** I actually have used a lot of methods that have been replaced in the 2021 version of the Revit API.

I use some of the methods of the `UnitUtils` class... some of then were replaced.

When Visual Studio compiles my code, does it adapt, or recognize the old methods and somehow translate them to the new ones?

Thats the only thing I can think of.

**Answer:** `UnitUtils` hasn't been removed in R2021, it will be gone in R2022 (if it follows the same route as always).

See [Obsolete API removal](https://thebuildingcoder.typepad.com/blog/2020/04/whats-new-in-the-revit-2021-api.html).

Only the *Autodesk.Revit.DB.ImageImportOptions* and methods relating to it have now been removed (and would return a error).

Once a function is replaced or obsolete (deprecated), it will be removed in the next Revit version.

For instance, `ParameterFilterElement.GetRules` is marked as deprecated in the Revit 2019 API and was removed completely in Revit 2020.

That gives you one year's time to update your code to remove all dependencies on deprecated API.

Ensure that your add-in compiles with zero warnings, and you will be ready to compile it for the next major release of Revit as well.

If your code generates warnings about using deprecated code now, it will no longer run unmodified in the next major release of Revit.

Many thanks to Michel for the detailed explanation!

Many thanks to Michel for the detailed explanation!

To summarise and point out the gist of this:

This procedure gives you one year's time to update your code to remove all dependencies on deprecated API.

Ensure that your add-in compiles with zero warnings, and you will be ready to compile it for the next major release of Revit as well.

If your code generates warnings about using deprecated code now, it will no longer run unmodified in the next major release of Revit.

####<a name="5"></a> Determine Outer Loop Around Points

I had a nice discussion with Francisco Contreras on determine an outer loop around given points in
a [series](https://thebuildingcoder.typepad.com/blog/2017/10/disjunct-outer-loops-from-planar-face-with-separate-parts.html#comment-4898621997)
of [comments](https://thebuildingcoder.typepad.com/blog/2017/10/disjunct-outer-loops-from-planar-face-with-separate-parts.html#comment-4900661008) on the article
on [disjunct planar face outer loops](https://thebuildingcoder.typepad.com/blog/2017/10/disjunct-outer-loops-from-planar-face-with-separate-parts.html):

**Question:** I have a `List&lt;xyz&gt;` with elements that allways are circumscribed to a quad.

I need to get the outer loop of it and store it like a face.

I know you cannot create faces, but the outer loop is good enough; I created a class that store it.

Do you know how can I do it?

<center>
<img src="img/outer_loop_of_points_1.png" alt="Outer loop around points" title="Outer loop around points" width="332"/>
</center>

**Answer:** This is either very simple or just plain simple.

The very simple solution is to determine the concave hull of your points.

The less simple task would be to retrieve the (non-concave, convex) outer loop.

Very much less simple, actually.

What *IS* the outer loop unless you have a convex hull?

Take another look at your points:

<center>
<img src="img/outer_loop_of_points_2.png" alt="Outer loop around points" title="Outer loop around points" width="332"/>
</center>

Is the outer loop A-B-C-E-G-H?

Why is it not A-B-C-D-E-G-H?

Or A-B-C-D-E-F-G-H?

Or A-B-C-E-G-H-F-D-A?

I recommend you just go for
the [convex hull](https://www.google.com/search?q=convex+hull&as_sitesearch=thebuildingcoder.typepad.com),
e.g., with this [algorithm](https://thebuildingcoder.typepad.com/blog/2016/08/online-revit-api-docs-and-convex-hull.html#3).

Oh, I see now that you mention it is a quad... so it is convex in any case.

Problem solved.

**Response:** Many thanks for your help, IÂ´m trying to implement it.

Question, this should work for any set of points on a given plane?

Or, should I change something if the plane is vertical or horizontal?

Because the code Written by Maxence is giving me an infinite loop, the program does not go beyond the third point.

**Answer:** For a 2D convex hull computation, you would normally expect to be working with 2D points.

If your points are in a horizontal plane, discard all Z coordinates.

In a vertical plane aligned with the X axis, discard Y; aligned with Y axis, discard X. Else rotate the coordinates appropriately.

In a slanted plane, transform your coordinates into the XY plane.

I implemented
a [2D convex hull calculation](https://thebuildingcoder.typepad.com/blog/2016/08/online-revit-api-docs-and-convex-hull.html)
in [The Building Coder samples](https://github.com/jeremytammik/the_building_coder_samples).

I implemented [transformation of 3D points into a 2D plane](http://thebuildingcoder.typepad.com/blog/2008/12/3d-polygon-areas.html) in
order to make use of
the [2D polygon area calculation for 3D planar polygons](http://thebuildingcoder.typepad.com/blog/2008/12/2d-polygon-areas-and-outer-loop.html).
