<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head>

<!---


twitter:

 in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon 

&ndash; 
...

linkedin:


-->

### Set Floor Level and Use IPC for Disentanglement

Revit 2020 has been released, and we go through the same procedure as every year, looking at the DevDays online presentation highlighting the API news, getting the system requirements set up, installing, compiling the Revit SDK samples and setting up RvtSamples to load them:

- [Revit 2020 Released](#2) 
- [Revit 2020 DevDays Online Presentation](#3) 
- [Setting Up Windows and Visual Studio](#4) 
- [Compiling the Revit 2020 SDK Samples](#5) 
- [Setting up the RvtSamples Application](#6) 

<center>
<img src="img/rvtsamples2020.png" alt="RvtSamples loaded all Revit 2020 external commands" width="600">
</center>

#### <a name="2"></a> Revit 2020 Released

Here is an overview by Harlan Brumm
on [What's New in Revit 2020](https://blogs.autodesk.com/revit/2019/04/10/youve-got-to-see-whats-new-in-revit-2020).

#### <a name="3"></a> Revit 2020 DevDays Online Presentation

We held a series of DevDays online presentations.

Here are the recordings:


#### <a name="4"></a> Setting Up Windows and Visual Studio

Revit 2020 rejects Windows 8.1, so I am forced to finally update to Windows 10:

<center>
<img src="img/revit_2020_rejects_win_8_1.png" alt="Revit 2020 rejects Windows 8.1" width="432">
</center>

Revit 2020 installation
Y:\downloads\Revit_2020_G1_Win_64bit_wi_en-US_Setup_webinstall.exe
Windows 10 installation
https://www.microsoft.com/en-us/software-download/windows10ISO
~/downloads/Win10_1809Oct_v2_EnglishInternational_x64.iso
product key
http://msdn.microsoft.com/subscriptions
jeremytammik@hotmail.com
https://my.visualstudio.com/ProductKeys
Windows 10 (business edition), version 1803 (Updated Aug 2018) -- Windows 10 Pro  TNTH9-J362Y-KK74V-R4WF8-82QGT Retail 11/Apr/2019
Revit SDK installation via Setup.exe > Tools and Utilities, not included up front, needs to be downloaded separately
once done, that adds:
C:\Autodesk\WI\Autodesk Revit 2020\Utilities\SDK\RevitSDK.exe
installed to
C:\a\lib\revit\2020\SDK
/v/C/a/lib/revit/2020/SDK/
new online help files at
http://help.autodesk.com/view/RVT/2020/ENU/
developer guide
http://help.autodesk.com/view/RVT/2020/ENU/?guid=Revit_API_Revit_API_Developers_Guide_html
development requirements
http://help.autodesk.com/view/RVT/2020/ENU/?guid=Revit_API_Revit_API_Developers_Guide_Introduction_Getting_Started_Welcome_to_the_Revit_Platform_API_Development_Requirements_html
.NET 4.7
Microsoft Visual Studio 2015 Professional
https://dotnet.microsoft.com/download/thank-you/net472-developer-pack
.NET 4.7.2 setup failed
restarted windows
implement test console app using 4.7.2, success
.NET 4.7.2 setup succeeded, but still cannot buils SDKSamples.sln
installing .net 4.7 (no .1 or .2 suffix) developer pack next
https://www.microsoft.com/en-us/download/confirmation.aspx?id=55168
restart windows
implement test console app using 4.7.0
compiled sdk samples, fixed errors by converting to warnings
installed Microsoft Office 2010: Primary Interop Assemblies Redistributable 
https://www.microsoft.com/en-US/Download/confirmation.aspx?id=3508
the excel interop dll is already present in several revit sdk samples, e.g.:
./a/lib/revit/2020/SDK/Samples/ArchSample/VB.NET/Microsoft.Office.Interop.Excel.dll

#### <a name="5"></a> Compiling the Revit 2020 SDK Samples

Afgter I was finally able to load the SDK samples solution into Visual Studio without all projects being set back to .NET 4.5, I started the first compilation run.

It produced [17 errors and 38 warnings, cf. `revit_2020_sdk_samples_errors_warnings_1.txt`](zip/revit_2020_sdk_samples_errors_warnings_1.txt).

The first error CS1591 complains about a *Missing XML comment for publicly visible type or member* in the Custom2DExporter project.

A newly added project, very exciting topic, lets discuss it asap, first get this error fixed, though.

In fact, the Custom2DExporter project has is set to *Treat warnings as errors*, so we can start by turning that off for the moment. That helps, and reduces the error count.

We now have [9 errors and 46 warnings, cf. `revit_2020_sdk_samples_errors_warnings_2.txt`](zip/revit_2020_sdk_samples_errors_warnings_2.txt).

Modifying the *Treat warnings as errors* setting to 'None' for the PathOfTravel, RebarFreeForm and SampleCommandsSteelElements projects as well reduces the errors to one single one:

- Error	CS0234, *The type or namespace name 'Office' does not exist in the namespace 'Microsoft'" in the PointCurveCreation project

Well, yes, I don't have Microsoft Office installed on my virtual machine, so that makes sense.

On the other hand, of course, the number of warnings are now higher:
[1 error and 54 warnings, cf. `revit_2020_sdk_samples_errors_warnings_3.txt`](zip/revit_2020_sdk_samples_errors_warnings_3.txt).

For a quick fix, I temporarily unloaded the PointCurveCreation project.

That leads to [0 errors,
52 warnings,
189 projects succeeded, 0 failed, 0 skipped, cf. `revit_2020_sdk_samples_errors_warnings_4.txt`](zip/revit_2020_sdk_samples_errors_warnings_4.txt).

Later, I noticed that the Excel Interop DLL is already present as a component in several other Revit SDK samples, e.g., in:

- .../Samples/ArchSample/VB.NET/Microsoft.Office.Interop.Excel.dll

I therefore reloaded the PointCurveCreation project again, added a reference by browsing to the existing DLL, and now have

[0 errors,
52 warnings,
190 projects succeeded, 0 failed, 0 skipped, cf. `revit_2020_sdk_samples_errors_warnings_5.txt`](zip/revit_2020_sdk_samples_errors_warnings_5.txt).

Very many of the warnings refer to the architecture mismatch that I implemented a fix for back in

- warning MSB3270: There was a mismatch between the processor architecture of the project being built "MSIL" and the processor architecture of the reference "RevitAPI", "AMD64". This mismatch may cause runtime failures. Please consider changing the targeted processor architecture of your project through the Configuration Manager so as to align the processor architectures between your project and references, or take a dependency on references with a processor architecture that matches the targeted processor architecture of your project.

I ran my DisableMismatchWarning.exe utility in the SDK Samples installation folder, that reduced the number to

[0 errors,
21 warnings,
190 projects succeeded, 0 failed, 0 skipped, cf. `revit_2020_sdk_samples_errors_warnings_6.txt`](zip/revit_2020_sdk_samples_errors_warnings_6.txt).

Later, I found a much simpler solution to the *Missing XML comment* warning in Custom2DExporter, PathOfTravel, RebarFreeForm and SampleCommandsSteelElements projects: simply uncheck the box in the build setting requestion the generation of an *XML documentation file*. After that, the *Treat warnings as errors* setting can be safely turned back on again. That reduce the number further to 

[0 errors,
5 warnings,
190 projects succeeded, 0 failed, 0 skipped, cf. `revit_2020_sdk_samples_errors_warnings_7.txt`](zip/revit_2020_sdk_samples_errors_warnings_7.txt).

These remaining warnings are due to some weird settings in the project files that I will ignore for now.

#### <a name="6"></a> Setting up the RvtSamples Application

My next step will be to set up RvtSamples to load most of the SDK external commands.

RvtSamples is an external application that creates a menu and populates it with entries for all the external commands defined by the Revit SDK, making them accessible with one single click and saving me the effort of installing each and every sample command individually with its own add-in manifest.

In order to do so, RvtSamples reads an input text file, RvtSamples.txt, that defines the location of all the external command assebly DLLs and the names of the .NET classes they contain implementing the external commands.

First of all, I edit that input text file.

It is initially set to the default installation location:

- C:\Revit SDK 2020\Software Development Kit\Samples\

I replace that globally by my local installation folder *C:\a\lib\revit\2020\SDK\Samples\*... 234 occurences are replaced.

Next, I edit the RvtSamples add-in manifest, RvtSamples.addin, to point to the location of the RvtSamples DLL itself:

<pre class="code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;RevitAddIns&gt;
  &lt;AddIn Type="Application"&gt;
    &lt;Name&gt;RvtSamples External Application&lt;/Name&gt;
    &lt;Assembly&gt;C:\a\lib\revit\2020\SDK\Samples\RvtSamples\CS\bin\Debug\RvtSamples.dll&lt;/Assembly&gt;
    &lt;ClientId&gt;42cb0a70-2ee7-4e64-a42d-87b9cdcc41c8&lt;/ClientId&gt;
    &lt;FullClassName&gt;RvtSamples.Application&lt;/FullClassName&gt;
    &lt;VendorId&gt;ADSK&lt;/VendorId&gt;
    &lt;VendorDescription&gt;Autodesk, www.autodesk.com&lt;/VendorDescription&gt;
  &lt;/AddIn&gt;
&lt;/RevitAddIns&gt;
</pre>

It needs to be copied to the Revit 2020 Add-Ins folder in order for Revit to pick it up and load it:

- C:\Users\tammikj\AppData\Roaming\Autodesk\Revit\Addins\2020

As usual, after that, a whole bunch of errors occur and need to be handled.

In spite of the development team fixing my issue requesting this to work out of the box.

No way.

Ah well.

The first error I see says:

- Assembly 'C:\a\lib\revit\2020\SDK\Samples\PhaseSample\VB.NET\bin\Debug\PhaseSample.dll' specified in line 147 of RvtSamples.txt not found

This and similar errors have shown up every single year and affect most of the VB.NET samples.

In this case, the RvtSamples.txt input file searches for:

- C:\a\lib\revit\2020\SDK\Samples\PhaseSample\VB.NET\bin\Debug\PhaseSample.dll

This file does not exist. Instea, for some reason, the assembly DLL is located one levels further up:

- C:\a\lib\revit\2020\SDK\Samples\PhaseSample\VB.NET\bin\PhaseSample.dll

As a quick stop-gap fix, I simply globally replace all occurences of *\VB.NET\bin\Debug\* by *\VB.NET\bin\*.

Next errors:

- External command class Revit.SDK.Samples.DatumsModification.CS.Command in assembly 'C:\a\lib\revit\2020\SDK\Samples\DatumsModification\CS\bin\Debug\DatumsModification.dll' specified in line 350 of RvtSamples.txt not found
- Assembly 'C:\a\lib\revit\2020\SDK\Samples\Viewers\ElementViewer\VB.NET\bin\ElementViewer.dll' specified in line 861 of RvtSamples.txt not found

ElementViewer.dll really is located in the `bin\debug` subdirectory, so I changed that back again.

- Assembly 'C:\a\lib\revit\2020\SDK\Samples\CreateShared\VB.NET\bin\CreateShared.dll' specified in line 1155 of RvtSamples.txt not found
- Assembly 'C:\a\lib\revit\2020\SDK\Samples\TestFloorThickness\VB.NET\bin\TestFloorThickness.dll' specified in line 1225 of RvtSamples.txt not found
- The assembly does not exist.
Parameter name: pushButtonData.AssemblyName: n = 1638, k = 1638, lines[k] = eof

Hmmm. Fixed some of those...

Next test run...

- External command class Revit.SDK.Samples.DatumsModification.CS.Command in assembly 'C:\a\lib\revit\2020\SDK\Samples\DatumsModification\CS\bin\Debug\DatumsModification.dll' specified in line 350 of RvtSamples.txt not found

Well, no wonder. The external command defined by the DatumsModification add-in is not named `Command` at all.

Instead, it defines three external commands, named `DatumStyleModification`, `DatumAlignment` and `DatumPropagation`.

Therefore, the single erroneous entry for one external command for this add-in needs to be replaced by three new ones.

This sample can never have been loaded by RvtSamples.

Anyway, I fixed all the errors, it seems, and can now load RvtSamples and successfully process its input file in Revit 2020:

<center>
<img src="img/rvtsamples2020.png" alt="RvtSamples loaded all Revit 2020 external commands" width="600">
</center>

Here are my versions of the files I modified to get it up and running:

- [RvtSamples.addin](zip/RvtSamples2020.addin)
- [RvtSamples.txt](zip/RvtSamples2020.txt)


