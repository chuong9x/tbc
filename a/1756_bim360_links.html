<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head></p>
<!---

twitter:

 in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon

&ndash;
...

linkedin:


#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk

-->

<h3>Accessing BIM360 Cloud Links</h3>
<h4><a name="2"></a></h4>
<p>My colleague Eason Kang</p>
<p><strong>Question:</strong> In Revit 2017, I used a method based on <code>ExternalFileReferences</code> to report linked files hosted in BIM360.</p>
<p>In Revit 2019 this method no longer works.</p>
<ul>
<li><code>TransmissionData</code> <code>GetAllExternalFileReferenceIds</code> , used in the attached sample from Jeremyâ€™s blog, List Linked Files and TransmissionData, does not report links hosted in BIM360, and it reports local files that are linked only. This is an old sample.</li>
<li>The similar <code>ExternalFileUtils</code> <code>GetAllExternalFileReferences</code> method similarly does not return these items.</li>
</ul>
<p>Has there been a change in this area?</p>
<p>Is there a different method we should be using?</p>
<p><strong>Answer:</strong> Neither of these two methods support cloud links in Revit 2018 or Revit 2019.</p>
<p>In Revit 2017, they appeared to work, because back then, the cloud links were downloaded as local copies by the Autodesk Desktop Connector before linking.</p>
<p>Nowadays, BIM360 cloud links are treated as external sources. This behaviour started from with Revit 2018.</p>
<p>Therefore, please use <code>ExternalResourceUtils</code> <code>GetAllExternalResourceReferences</code> instead.</p>
<p>Here is a working code snippet:</p>
<pre class="code">
// Obtain all external resource references (Saying BIM360 Cloud references and local file references this time)
var xrefs = ExternalResourceUtils.GetAllExternalResourceReferences(doc);
var msg = string.Empty;

try
{
    foreach (var eid in xrefs)
    {
        var elem = doc.GetElement(eid);
        if (elem == null) continue;

        var link = elem as RevitLinkType;  //!<<< Get RVT document links only this time
        if (link == null) continue;

        var map = link.GetExternalResourceReferences();
        var keys = map.Keys;

        foreach (var key in keys)
        {
            var reference = map[key];
            var dictinfo = reference.GetReferenceInformation(); //!<<< Contains Forge BIM360 ProjectId(i.e. LinkedModelModelId) & ModelId (i.e. LinkedModelModelId) if it's from BIM360 Docs. It can be used in ModelPathUtils#ConvertCloudGUIDsToCloudPath calls
            var displayName = reference.GetResourceShortDisplayName();  //!<<< Link Name shown on the Manage Links dialog
            var path = reference.InSessionPath;
        }

        try
        {
           //Load model temporarily to get the model path of the cloud link
            var result = link.Load();
            var mdPath = result.GetModelName();   //!<<< Link ModelPath for Revit internal use
            link.Unload(null);

            var path = ModelPathUtils.ConvertModelPathToUserVisiblePath(mdPath); //!<<< Convert model path to user visible path, i.e. saved Path shown on the Manage Links dialog
            var refType = link.AttachmentType;  //!<<< Reference Type shown on the Manage Links dialog
            msg += string.Format("{0} {1}\n", link.AttachmentType, path);
        }
        catch (Exception ex)
        {
            TaskDialog.Show("Revit", ex.Message);
        }
    }

    TaskDialog.Show("Revit", msg);
}
catch(Exception ex)
{
    TaskDialog.Show("Revit", ex.Message);
}
</pre>

<p>And the result snapshots:</p>
<p><center>
<img src="img/bim360_links_1.png" alt="BIM360 link" width="352">
</center></p>
<p><center>
<img src="img/bim360_links_2.png" alt="BIM360 link" width="876">
</center></p>
<p>Many thanks to Eason for this research and clear explanation!</p>
<h4><a name="3"></a> RoomVolumeDirectShape Functionality</h4>
<p>the <a href="http://forums.autodesk.com/t5/revit-api-forum/bd-p/160">Revit API discussion forum</a> thread</p>