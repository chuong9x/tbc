<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</head></p>
<!---

- get sheet from view 
  12966349 [Get ViewSheet from View]
  https://forums.autodesk.com/t5/revit-api-forum/get-viewsheet-from-view/m-p/7075550

twitter:

 the #RevitAPI #DynamoBim @AutodeskForge @AutodeskRevit #bim #ForgeDevCon 

&ndash; 
...

linkedin:


#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="100"/>
<p style="font-size: 80%; font-style:italic"></p>
</center>

-->

<h3>Get Title Block Data and ViewSheet from View</h3>
<p>Today, let's highlight to view related data access topics:</p>
<ul>
<li><a href="#2">Get ViewSheet from View</a></li>
<li><a href="#3">Title block data access</a></li>
</ul>
<h4><a name="2"></a>Get ViewSheet from View</h4>
<p>An intersting in-depth conversation in 
the <a href="http://forums.autodesk.com/t5/revit-api-forum/bd-p/160">Revit API discussion forum</a> thread
on how to <a href="https://forums.autodesk.com/t5/revit-api-forum/get-viewsheet-from-view/m-p/7075550">get ViewSheet from View</a> presents
two different approaches to determine relationships between sheets and the views they host:</p>
<p><strong>Question:</strong> Is there a way to get the <code>ViewSheet</code> or <code>ElementId</code> of the <code>ViewSheet</code> from a <code>View</code> that is placed on that sheet?</p>
<p>I can get the sheet name and sheet number from the provided parameters but do not see one for the actual ViewSheet.  Am I missing something?  The only thing i can think of to do without this info is to loop through all ViewSheets to match the one with the same sheet number (since sheet number is required to be unique).   </p>
<p><strong>Answer:</strong> Have you looked at the sample code provided in the <a href="http://www.revitapidocs.com/2017/af2ee879-173d-df3a-9793-8d5750a17b49.htm">description of the ViewSheet class</a>?</p>
<pre class="code">
  ICollection<ElementId> views = viewSheet.GetAllPlacedViews();
  message += "\nNumber of views in the sheet : " + views.Count;
</pre>

<p>If all else fails, you could use this relationship and invert it.</p>
<p>The <a href="http://www.revitapidocs.com/2017/bfa96650-310e-5385-3a9d-1a1248b623ce.htm">View.Title property</a> also
generally consists of the view name plus other modifiers, such as the view type, sheet number, area scheme, and/or assembly type, depending on the specifics of the view:</p>
<p><strong>Response:</strong> You must have misunderstood my question.  I don't have the ViewSheet in order to use the method to get its placed views.  I have a view, that I know is on a sheet (because its sheet number parameter is not null), but I want to get a direct reference to that sheet that it is placed on.  It seems to me that you are still suggesting that I must loop through all ViewSheets to get the View that I'm concerned with.  Thanks.</p>
<p><strong>Answer:</strong> Yes, indeed, that is exactly what I am suggesting.</p>
<p>Get all the view sheets, keep track of them and the views they host, and invert that relationship, as described in one of the very early discussions by The Building Coder back in 2008 on a <a href="http://thebuildingcoder.typepad.com/blog/2008/10/relationship-in.html">relationship inverter</a>.</p>
<p>That gives you a complete dictionary lookup both ways: you can look up the sheet hosting any view and you con look up all the views hosted by any sheet, instantaneously.</p>
<p>It takes a moment to set up the relationships; after that, all data is available and lookup is very fast.</p>
<p><strong>Other answer:</strong> You can perhaps get VIEWPORT_SHEET_NUMBER from Parameters.</p>
<p><strong>Yet another answer:</strong> I maybe have a workaround for this question, something similar I assume.</p>
<p>Select some views in the Project Browser to know if the views are placed on sheet(s).</p>
<p>Then, run a macro or IExternalcommand to execute the command, something like inserted (macro)code as an example;
If view is placed on Sheet, then show the sheetnumber, sheetname or whatever data you interested in of the ViewSheet that is referenced to the selected views in the Project Browser.</p>
<p>Hope this is useful for you or point you to the right direction.</p>
<pre class="code">
  public void GetViewSheetFromView()
  {
    UIDocument uidoc = this.ActiveUIDocument;
    Document doc = uidoc.Document;      
    string data = "";

    ICollection<ElementId> selectedIds = uidoc.Selection.GetElementIds();

    foreach (ElementId selectedid in selectedIds)
    {      
      View e = doc.GetElement(selectedid) as View;

      foreach (View v in new FilteredElementCollector(doc).OfClass(typeof(View)).Cast<View>().Where(q => q.Id.Equals(e.Id)))
      {
        string thisSheet = "";
        foreach (ViewSheet vs in new FilteredElementCollector(doc).OfClass(typeof(ViewSheet)).Cast<ViewSheet>())
        {
          foreach (ElementId eid in vs.GetAllPlacedViews())
          {
            View ev = doc.GetElement(eid) as View;
            if(ev.Id == v.Id)
            {
              thisSheet += vs.SheetNumber + " - " + vs.Name + Environment.NewLine ;
              break;
            }
          }
        }

        if (thisSheet != "")
        {
          data += v.ViewType + ": " + v.Name + " " + Environment.NewLine + thisSheet.TrimEnd(' ',',') + Environment.NewLine;
        }

        else
        {
          data +=  v.ViewType + ": " + v.Name + " " + Environment.NewLine + thisSheet.TrimEnd(' ',',');
          data += " NOT ON SHEET " +   Environment.NewLine + "\n" ;            
        }
      }
    }
    TaskDialog.Show("View Report", data);
  }
</pre>

<p><center>
<img src="img/GetViewSheetFromView.png" alt="Get ViewSheet from View" title="Get ViewSheet from View" width="800"/> <!-- 1815 -->
</center></p>
<p><strong>Yet another answer:</strong> As suggested above, using the BIP for viewport sheet number with an ElementParameterFilter is probably the best approach. Sheet numbers are unique in each Revit model, so it is safe to search by them and get the right result.</p>
<pre class="code">
  Public Function TObj43(ByVal commandData As Autodesk.Revit.UI.ExternalCommandData, _
    ByRef message As String, ByVal elements As Autodesk.Revit.DB.ElementSet) As Result

    If commandData.Application.ActiveUIDocument Is Nothing Then Return Result.Cancelled Else 
      Dim AcView As View = commandData.Application.ActiveUIDocument.ActiveGraphicalView

    Dim P_Ns As Parameter = AcView.Parameter(BuiltInParameter.VIEWPORT_SHEET_NUMBER)
    If P_Ns Is Nothing Then
      GoTo Monday
    End If

    Dim Txt As String = P_Ns.AsString
    If String.IsNullOrEmpty(Txt) Then GoTo Monday Else 
    Dim SeFR As FilterRule = ParameterFilterRuleFactory.CreateEqualsRule( _
      New ElementId(BuiltInParameter.SHEET_NUMBER), Txt, True)
    Dim PFilt As New ElementParameterFilter(SeFR, False)

    Dim FEC As New FilteredElementCollector(AcView.Document)
    Dim ECF As New ElementClassFilter(GetType(ViewSheet))
    Dim LandF As New LogicalAndFilter(ECF, PFilt)
    Dim Els As List(Of Element) = FEC.WherePasses(LandF).ToElements

    If Els.Count <> 1 Then
      GoTo Monday
    Else
      Dim TD As New TaskDialog("Was this your sheet...")
      TD.MainInstruction = Txt & "-" & Els(0).Name
      TD.MainContent = "Note that view types that can appear on " _
        + "multiple sheets (Legends, Images, Schedules etc.) will " _
        + " not be returned by this method."
      TD.Show()
      GoTo Friday
    End If
  Monday:
    TaskDialog.Show("Something went amiss...", _
      "We looked hard in many places but were unable to " _
      + "find your sheet on this occasion.")
    Return Result.Failed
  Friday:
    Return Result.Succeeded
  End Function
</pre>

<p><strong>Yet another answer:</strong> Here is a pretty quick way of checking for a specific sheet:</p>
<pre class="code">
  private ViewSheet CheckSheet(string _sheetNumber)
  {
    ParameterValueProvider pvp = new ParameterValueProvider(new ElementId(BuiltInParameter.SHEET_NUMBER));
    FilterStringRuleEvaluator fsr = new FilterStringEquals();
    FilterRule fRule = new FilterStringRule(pvp, fsr, _sheetNumber, true);
    ElementParameterFilter filter = new ElementParameterFilter(fRule);

    if (new FilteredElementCollector(doc).OfCategory(BuiltInCategory.OST_Sheets).WherePasses(filter).FirstOrDefault() is ViewSheet vs)
    {
      return vs;
    }
    else
    {
      return null;
    }
  }
</pre>

<p><strong>Summary:</strong> I believe this last solution is unbeatable if you are interested in one single lookup.</p>
<p>It uses a parameter filter and the <code>SHEET_NUMBER</code> built-in parameter.</p>
<p>Probably, the VB function <code>TObj43</code> above is similarly efficient.</p>
<p><code>GetViewSheetFromView</code> demonstrates the lookup of the inverted relationship I described, but just for one single view.</p>
<p>That code could be used to store the entire relationships mapping sheet to hosted views and the inverted one mapping each view to hosting sheets for all views and sheets. That might possibly be more efficient if you frequently need to look up several different view to sheet relationships.</p>
<p>Thank you all for the very illuminating and helpful answers!</p>
<h4><a name="3"></a>Title Block Data Access</h4>
<p><strong>Question:</strong> I am searching for some sample code for use in a Design Automation API project.</p>
<p>Rather than reinvent to wheel, I thought you might have a snippet handy showing how to read Revit drawing title block attributes like these:</p>
<p><center>
<img src="img/title_block_data_access.png" alt="Title block data access" title="Title block data access" width="600"/> <!-- 1390 -->
</center></p>
<p><strong>Answer:</strong> I discussed accessing
the <a href="https://thebuildingcoder.typepad.com/blog/2009/11/title-block-of-sheet.html">title block of a sheet</a> myself
back in 2009, but that information is rather antiquated now.</p>
<p>The question was also raised and answered in 
the <a href="http://forums.autodesk.com/t5/revit-api-forum/bd-p/160">Revit API discussion forum</a> thread
on <a href="https://forums.autodesk.com/t5/revit-api-forum/titleblock/td-p/3802588">TitleBlock</a>,
and that information is perfectly valid.</p>
<p>Ah, I now found a more recent and useful article on how
to <a href="https://thebuildingcoder.typepad.com/blog/2010/05/determine-sheet-size.html">determine sheet size</a> that
should provide all you need.</p>
<p>The code is included in
<a href="https://github.com/jeremytammik/the_building_coder_samples">The Building Coder samples</a>
<a href="https://github.com/jeremytammik/the_building_coder_samples/blob/master/BuildingCoder/BuildingCoder/CmdSheetSize.cs">module CmdSheetSize.cs</a>.</p>
<p>The title block instances are family instance elements.
You can access the title block element using a filtered element collector, e.g.:</p>
<pre class="code">
&nbsp;&nbsp;<span style="color:#2b91af;">FilteredElementCollector</span>&nbsp;title_block_instances
&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">FilteredElementCollector</span>(&nbsp;doc&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.OfCategory(&nbsp;<span style="color:#2b91af;">BuiltInCategory</span>.OST_TitleBlocks&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.OfClass(&nbsp;<span style="color:blue;">typeof</span>(&nbsp;<span style="color:#2b91af;">FamilyInstance</span>&nbsp;)&nbsp;);
</pre>

<p>You can loop through these elements and retrieve the required data from their built-in parameters, such as SHEET_NAME, SHEET_NUMBER, SHEET_DRAWN_BY, SHEET_CHECKED_BY etc., like this:</p>
<pre class="code">
  <span style="color:blue;">foreach</span>(&nbsp;<span style="color:#2b91af;">FamilyInstance</span>&nbsp;e&nbsp;<span style="color:blue;">in</span>&nbsp;a&nbsp;)
  {
  &nbsp;&nbsp;p&nbsp;=&nbsp;e.get_Parameter(
  &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">BuiltInParameter</span>.SHEET_NUMBER&nbsp;);

  &nbsp;&nbsp;<span style="color:#2b91af;">Debug</span>.Assert(&nbsp;<span style="color:blue;">null</span>&nbsp;!=&nbsp;p,
  &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a31515;">&quot;expected&nbsp;valid&nbsp;sheet&nbsp;number&quot;</span>&nbsp;);

  &nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;sheet_number&nbsp;=&nbsp;p.AsString();

  &nbsp;&nbsp;p&nbsp;=&nbsp;e.get_Parameter(
  &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">BuiltInParameter</span>.SHEET_WIDTH&nbsp;);

  &nbsp;&nbsp;<span style="color:#2b91af;">Debug</span>.Assert(&nbsp;<span style="color:blue;">null</span>&nbsp;!=&nbsp;p,
  &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a31515;">&quot;expected&nbsp;valid&nbsp;sheet&nbsp;width&quot;</span>&nbsp;);

  &nbsp;&nbsp;<span style="color:blue;">string</span>&nbsp;swidth&nbsp;=&nbsp;p.AsValueString();
  &nbsp;&nbsp;<span style="color:blue;">double</span>&nbsp;width&nbsp;=&nbsp;p.AsDouble();

    . . . 
  }
</pre>

<p>Als always, you can use <a href="https://github.com/jeremytammik/RevitLookup">RevitLookup</a> to explore this data interactively yourself in your own model to see which properties are available where and what other title block information may be of interest to your application.</p>