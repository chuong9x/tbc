<head>
<link rel="stylesheet" type="text/css" href="bc.css">
</head>

<!-- 1255511 [Problem with API Sample Import-Export putting - after file name] -->

<h3>Modify the DWF Export Filename</h3>

<p>Here is another case handled by Joe Ye regarding the DWF output filename generated by the ImportExport Revit SDK sample.
We already presented another related case of his regarding the 

<a href="http://thebuildingcoder.typepad.com/blog/2009/08/dwg-export-filename.html">
DWG export filename</a>.

<p><strong>Question:</strong> This problem is similar to the ViewPrinter problem where the program automatically names the output file. 
Please tell me how I can trap the naming of DWF output file so I can either send it to a temp folder or rename it by moving to a new folder. 
The problem seems to be when you create a DWF with multiple sheets in it &ndash; the program will append a dash suffix "-" at the end. 

<p><strong>Answer:</strong> Yes, if we export to DWF in merge mode, a suffix will be added to the end of the file name. 
The problem is that the API does not provide full access to directly and completely control the output file name.
The solution is that we can export the DWF file to a temp folder, and then copy and rename the file to the desired destination folder.
For exporting a 2D DWF file, the code to change is in Export2DDWFData.cs. 
I changed it as follows:

<pre class="code">
<span class="blue">public</span> <span class="blue">override</span> <span class="blue">bool</span> Export()
{
&nbsp; <span class="blue">bool</span> exported = <span class="blue">false</span>;
&nbsp; <span class="blue">base</span>.Export();
&nbsp;
&nbsp; <span class="green">//parameter : ViewSet views</span>
&nbsp; <span class="teal">ViewSet</span> views = <span class="blue">new</span> <span class="teal">ViewSet</span>();
&nbsp; <span class="blue">if</span>( m_currentViewOnly )
&nbsp; {
&nbsp; &nbsp; views.Insert( m_activeDoc.ActiveView );
&nbsp; }
&nbsp; <span class="blue">else</span>
&nbsp; {
&nbsp; &nbsp; views = m_selectViewsData.SelectedViews;
&nbsp; }
&nbsp;
&nbsp; <span class="green">// Export DWFx</span>
&nbsp; <span class="blue">if</span>( m_exportFormat == <span class="teal">ExportFormat</span>.DWFx2D )
&nbsp; {
&nbsp; &nbsp; <span class="teal">DWFX2DExportOptions</span> options = <span class="blue">new</span> <span class="teal">DWFX2DExportOptions</span>();
&nbsp; &nbsp; options.ExportObjectData = m_exportObjectData;
&nbsp; &nbsp; options.ExportingAreas = m_exportAreas;
&nbsp; &nbsp; options.MergedViews = m_exportMergeFiles;
&nbsp; &nbsp; options.ImageFormat = m_dwfImageFormat;
&nbsp; &nbsp; options.ImageQuality = m_dwfImageQuality;
&nbsp;
&nbsp; &nbsp; <span class="blue">if</span>( m_exportMergeFiles == <span class="blue">false</span> )
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; <span class="blue">string</span> strTempFolder = <span class="maroon">&quot;C:/tmp&quot;</span>;
&nbsp;
&nbsp; &nbsp; &nbsp; exported = m_activeDoc.Export( strTempFolder, 
&nbsp; &nbsp; &nbsp; &nbsp; m_exportFileName, views, options );
&nbsp;
&nbsp; &nbsp; &nbsp; <span class="teal">File</span>.Copy( 
&nbsp; &nbsp; &nbsp; &nbsp; strTempFolder + <span class="maroon">&quot;/&quot;</span> + m_exportFileName + <span class="maroon">&quot;-.DWFx&quot;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; m_exportFolder + <span class="maroon">&quot;/&quot;</span> + m_exportFileName + <span class="maroon">&quot;.DWFx&quot;</span> );
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="blue">else</span>
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; exported = m_activeDoc.Export( m_exportFolder, 
&nbsp; &nbsp; &nbsp; &nbsp; m_exportFileName, views, options );
&nbsp; &nbsp; }
&nbsp; }
&nbsp; <span class="green">// Export DWF</span>
&nbsp; <span class="blue">else</span>
&nbsp; {
&nbsp; &nbsp; <span class="teal">DWF2DExportOptions</span> options = <span class="blue">new</span> <span class="teal">DWF2DExportOptions</span>();
&nbsp; &nbsp; options.ExportObjectData = m_exportObjectData;
&nbsp; &nbsp; options.ExportingAreas = m_exportAreas;
&nbsp; &nbsp; options.MergedViews = m_exportMergeFiles;
&nbsp; &nbsp; options.ImageFormat = m_dwfImageFormat;
&nbsp; &nbsp; options.ImageQuality = m_dwfImageQuality;
&nbsp; &nbsp; <span class="blue">if</span>( m_exportMergeFiles == <span class="blue">false</span> )
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; <span class="blue">string</span> strTempFolder = <span class="maroon">&quot;C:/tmp&quot;</span>;
&nbsp;
&nbsp; &nbsp; &nbsp; exported = m_activeDoc.Export( strTempFolder, 
&nbsp; &nbsp; &nbsp; &nbsp; m_exportFileName, views, options );
&nbsp;
&nbsp; &nbsp; &nbsp; <span class="teal">File</span>.Copy( 
&nbsp; &nbsp; &nbsp; &nbsp; strTempFolder + <span class="maroon">&quot;/&quot;</span> + m_exportFileName + <span class="maroon">&quot;-.DWF&quot;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; m_exportFolder + <span class="maroon">&quot;/&quot;</span> + m_exportFileName + <span class="maroon">&quot;.DWF&quot;</span> );
&nbsp; &nbsp; }
&nbsp; &nbsp; <span class="blue">else</span>
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; exported = m_activeDoc.Export( m_exportFolder, 
&nbsp; &nbsp; &nbsp; &nbsp; m_exportFileName, views, options );
&nbsp; &nbsp; }
&nbsp; }
&nbsp; <span class="blue">return</span> exported;
}
</pre>

<p>You could also optionally delete the intermediate file after copying it, or use File.Move instead of File.Copy.

<p>I tested this solution, and it works well for me. 
Please make analogous changes for the other file formats, if you need them.

<p>Many thanks to Joe for handling this case!

<p>By the way, this is a pretty common issue that was also addressed by Rod Howarth in his 

<a href="http://thebuildingcoder.typepad.com/blog/2009/12/au-winds-down.html">
AU presentation</a>.

He uses a similar approach in his PLT utility, which batch plots to PDF, DWG, DWF and paper, to trap the output generated by the Revit API call and rename the files to suit his requirements.
One part of the solution that he suggests is to print out the sheets one at a time to retain more complete control over the renaming and sorting.
