<head>
<link rel="stylesheet" type="text/css" href="bc.css">
</head>

<h3>Validate Roof Type and View OBJ on Android</h3>

<p>I spent some time exploring how to view the output generated by the 

<a href="http://thebuildingcoder.typepad.com/blog/2012/07/obj-model-exporter-with-transparency-support.html">
OBJ exporter</a> on an Android tablet.

<!--

checking out have had this Android tablet lying around for quite a while now, and so far still find it less handy than my laptop.

<p>On the other hand, I do see other people doing powerful things with these devices, and a friend of mine replaced his computer completely and nowadays uses nothing but his iPhone and iPad, with an external wireless keyboard attached to it. 
He wrote an entire book using that system, in fact.

<p>The most useful application for me so far is the star map, and I have learned a few new constellations and star names in the past weeks with its help.

<p>Anyway, the main reason I implemented the 

<a href="http://thebuildingcoder.typepad.com/blog/2012/07/obj-model-exporter-with-transparency-support.html">
OBJ exporter</a> was

to show how it can be viewed on a tablet device.

-->


<a name="2"></a>

<h4>Viewing an OBJ Model on Android</h4>

<p>That proved to be easy.
I installed the 

<a href="http://www.kiwiviewer.org">KiwiViewer</a>

open-source visualization app, which supports OBJ, and used 

<a href="https://www.dropbox.com">Dropbox</a>

to upload the OBJ export of my Revit model to the Internet, from where I could access it on the tablet from anywhere.
Anywhere with a wifi Internet link, that is.

<p>It works fine as far as the pure geometry defined in the OBJ file is concerned.
Unfortunately, the separate MTL material file was ignored, eliminating the colour and transparency information.

<p>The viewer displays other models with colour and other rendering information perfectly well, so I'll explore how those are defined appropriately next.

<p>Alternatively, I'll have to implement my own viewer. 
That may be the easiest route to go in order to achieve something useful, since that will soon require identifying the original Revit elements in the viewer, e.g. to communicate information from the tablet device back to the original Revit model.
For example, I might want to pick a building element and add a comment to it on the tablet, then have that information integrated back into the original document.
I hope to look at something like that soon.


<a name="3"></a>

<h4>Validate the Roof Type Compound Structure for the Little House</h4>

<p>I also happened to run the 'little house' command provided by the 

<a href="http://thebuildingcoder.typepad.com/blog/2012/04/xtra-adn-revit-2013-api-training-labs.html">
Xtra ADN training labs</a> again 

and was a bit surprised that the roof did not appear as expected.

<p>Exploring the resulting model in more depth, I notice that the roof was in fact being created successfully, but was not visible in the graphic view.

<p>I tracked it down to the roof type being used.
The sample just picks the first roof type encountered, which happened to be 'sloped glazing'.
This type has zero entries in its compound structure, or even worse, no compound structure defined at all.

<p>After adding a check for a valid compound structure to the type selection code, the roof appeared again:</p>

<center>
<img src="img/little_house_3d_view_2013.png" alt="Little house 3D view"/>
</center>

<p>Here is the plan view as well, although that does not show the roof, of course:</p>

<center>
<img src="img/little_house_plan_view_2013.png" alt="Little house plan view"/>
</center>

<p>This is the code checking for a valid compound structure in the list of roof types returned by the filtered element collector, then creating the roof and adding the slope to it:

<pre class="code">
&nbsp; <span class="green">// Add a floor, a roof and the roof slope:</span>
&nbsp;
&nbsp; <span class="blue">bool</span> structural = <span class="blue">false</span>;
&nbsp; <span class="teal">Floor</span> floor = createDoc.NewFloor( 
&nbsp; &nbsp; profile, structural );
&nbsp;
&nbsp; <span class="teal">List</span>&lt;<span class="teal">Element</span>&gt; roofTypes 
&nbsp; &nbsp; = <span class="blue">new</span> <span class="teal">List</span>&lt;<span class="teal">Element</span>&gt;( 
&nbsp; &nbsp; &nbsp; <span class="teal">LabUtils</span>.GetElementsOfType(
&nbsp; &nbsp; &nbsp; &nbsp; doc, <span class="blue">typeof</span>( <span class="teal">RoofType</span> ), 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="teal">BuiltInCategory</span>.OST_Roofs ) );
&nbsp;
&nbsp; <span class="teal">Debug</span>.Assert( 0 &lt; roofTypes.Count, 
&nbsp; &nbsp; <span class="maroon">&quot;expected at least one roof type&quot;</span>
&nbsp; &nbsp; + <span class="maroon">&quot; to be loaded into project&quot;</span> );
&nbsp;
&nbsp; <span class="green">// Ensure that we get a valid roof type. </span>
&nbsp; <span class="green">// In Revit 2013, the first one encountered </span>
&nbsp; <span class="green">// is sloped glazing with zero entries in</span>
&nbsp; <span class="green">// its compound layers; actually, the entire</span>
&nbsp; <span class="green">// compound structure is null:</span>
&nbsp;
&nbsp; <span class="teal">RoofType</span> roofType = roofTypes
&nbsp; &nbsp; .Cast&lt;<span class="teal">RoofType</span>&gt;()
&nbsp; &nbsp; .FirstOrDefault&lt;<span class="teal">RoofType</span>&gt;(
&nbsp; &nbsp; &nbsp; t =&gt; <span class="blue">null</span> != t.GetCompoundStructure() );
&nbsp;
&nbsp; <span class="teal">ModelCurveArray</span> modelCurves 
&nbsp; &nbsp; = <span class="blue">new</span> <span class="teal">ModelCurveArray</span>();
&nbsp;
&nbsp; <span class="teal">FootPrintRoof</span> roof 
&nbsp; &nbsp; = createDoc.NewFootPrintRoof( profile, 
&nbsp; &nbsp; &nbsp; levelTop, roofType, <span class="blue">out</span> modelCurves );
&nbsp;
&nbsp; <span class="green">// Regenerate the model after roof creation, </span>
&nbsp; <span class="green">// otherwise the calls to set_DefinesSlope and </span>
&nbsp; <span class="green">// set_SlopeAngle throwing the exception &quot;Unable</span>
&nbsp; <span class="green">// to access curves from the roof sketch.&quot;</span>
&nbsp;
&nbsp; doc.Regenerate();
&nbsp;
&nbsp; <span class="green">// The argument to set_SlopeAngle is NOT an </span>
&nbsp; <span class="green">// angle, it is really a slope, i.e. relation </span>
&nbsp; <span class="green">// of height to distance, e.g. 0.5 = 6&quot; / 12&quot;, </span>
&nbsp; <span class="green">// 0.75&nbsp; = 9&quot; / 12&quot;, etc.</span>
&nbsp;
&nbsp; <span class="blue">double</span> slope = 0.3;
&nbsp;
&nbsp; <span class="blue">foreach</span>( <span class="teal">ModelCurve</span> curve <span class="blue">in</span> modelCurves )
&nbsp; {
&nbsp; &nbsp; roof.set_DefinesSlope( curve, <span class="blue">true</span> );
&nbsp; &nbsp; roof.set_SlopeAngle( curve, slope );
&nbsp; }
</pre>

<p>Here is 

<a href="zip/adn_labs_2013_2012-08-27.zip">adn_labs_2013_2012-08-27.zip</a> 

containing the complete source code, Visual Studio solution, and RvtSamples include file to load my version of the ADN Revit API training labs including the additional commands defined by the Xtra projects, among them the little house creation lab described above.



<a name="4"></a>

<h4>Updated ADN Revit API Training Material</h4>

<p>This ties in very nicely with another little item: as

<a href="http://adndevblog.typepad.com/aec/2012/08/updated-revit-api-2013-training-labs-.html">
Mikako just pointed out</a> on 

<!-- C:\a\lib\revit\2013\adn\zip\Revit2013APITraining.zip -->

the AEC DevBlog, the Revit API 2013 training labs material on the 

<a href="http://www.autodesk.com/developrevit">Revit Developer Center</a> 

in the public Autodesk Developer Network site has been updated and is available for download in the 'Samples and Documentation' section.

Here is also a 

<a href="http://images.autodesk.com/adsk/files/Revit2013APITraining.zip">
direct link</a> to it.

<p>As Mikako points out, this is the material that we use for classroom trainings. 
If you know the basic of .NET programming and are interested in learning the Revit API, it also provides a good starting point for self-learning, since both source code and documents describing the steps to perform are included.

